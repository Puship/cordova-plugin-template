function Puship(){this._PushipAppId=null,this._DeviceId=null,this._DeviceToken=null,this._EnableLog=!1,this._EnableHtmlLog=!1,this._MinimumLocationCallDelayMinutes=1,this._DefaultLocationCallDelayMinutes=5,this._MinimumSingleLocationCallDelayMinutes=133,this._MinimumAccuracy=50,this._PositionQueueLenght=300,this._Domain="https://cloudapp.puship.com/",this._CurrentPlatform=null,this.log=function(t){if(1==this._EnableLog&&console.log(t),1==this._EnableHtmlLog){var e=document.getElementById("logp");e&&(e.innerHTML.length>5e3&&(e.innerHTML=e.innerHTML.substring(0,5e3)),e.innerHTML=(new Date).toLocaleTimeString()+" - "+t+"<br>"+e.innerHTML)}},this.isNullOrEmpty=function(t){return!t||null==t||""==t||0==t.length},this.iSODateString=function(t){return t.getUTCFullYear()+"-"+this.pad(t.getUTCMonth()+1)+"-"+this.pad(t.getUTCDate())+"T"+this.pad(t.getUTCHours())+":"+this.pad(t.getUTCMinutes())+":"+this.pad(t.getUTCSeconds())+"Z"},this.verifyAccuracy=function(t,e,i){return 1!=t||null==e||null==i||(e<i||(this.log("currentAccuracy:"+e+" - minAccuracy:"+i),!1))},this.convertPosition=function(t){var e=new Date(t.timestamp),i=this.iSODateString(e),s={};return s.Latitude=t.coords.latitude,s.Longitude=t.coords.longitude,s.Accuracy=t.coords.accuracy,s.TimeStamp=i,s.Speed=t.coords.speed,s.Heading=t.coords.heading,s.Altitude=t.coords.altitude,s.AltitudeAccuracy=t.coords.altitudeAccuracy,s},this.removeItemsFromLocalStorage=function(t,e){var i=localStorage.getObj(t);null==i&&(i=[]),i.splice(0,e),localStorage.setObj(t,i)},this.countItemOnLocalStorage=function(t){var e=localStorage.getObj(t);return null==e&&(e=[]),e.length},this.pushItemToLocalStorage=function(t,e){var i=localStorage.getObj(t);null==i&&(i=[]),i.push(e),localStorage.setObj(t,i)},this.getLastItemsFromLocalStorage=function(t,e){var i=localStorage.getObj(t);return null==i?i=[]:i.splice(0,e)},this.pad=function(t){return t<10?"0"+t:t},this.defaultValue=function(t,e){return void 0===t?e:t},this.getUuid=function(t){var e=localStorage.getItem("device.uuid");return null==e&&(e=device.uuid,localStorage.setItem("device.uuid",e)),e},this.getDeviceId=function(){return this._PushipAppId+"_"+this.getUuid()},this.getCurrentOs=function(t){if(null==this._CurrentPlatform){var e=device.platform;this.log("returned value as: "+e),e.search(/Android/i)>=0?this._CurrentPlatform=Puship.prototype.OS.ANDROID:e.search(/Win/i)>=0?this._CurrentPlatform=Puship.prototype.OS.WIN:e.search(/iPhone/i)>=0||e.search(/iPad/i)>=0||e.search(/iOS/i)>=0?this._CurrentPlatform=Puship.prototype.OS.IOS:this._CurrentPlatform=Puship.prototype.OS.BLACKBERRY}return this._CurrentPlatform},this.writeResponceStatus=function(t){t==RESPONSESTATUS.REGISTERED.value?this.log(RESPONSESTATUS.REGISTERED.name):t==RESPONSESTATUS.GENERICERROR.value?this.log(RESPONSESTATUS.GENERICERROR.name):t==RESPONSESTATUS.APPLICATIONNOTFOUND.value?this.log(RESPONSESTATUS.APPLICATIONNOTFOUND.name):t==RESPONSESTATUS.PERMISSIONERROR.value?this.log(RESPONSESTATUS.PERMISSIONERROR.name):t==RESPONSESTATUS.DEVICELIMITERROR.value?this.log(RESPONSESTATUS.DEVICELIMITERROR.name):t==RESPONSESTATUS.TAGLIMITERROR.value?this.log(RESPONSESTATUS.TAGLIMITERROR.name):t==RESPONSESTATUS.CREDENTIALERROR.value?this.log(RESPONSESTATUS.CREDENTIALERROR.name):t==RESPONSESTATUS.DEVICENOTFOUND.value?this.log(RESPONSESTATUS.DEVICENOTFOUND.name):this.log("Code not found")},this.registerInternal=function(t,e,i){this.PushipAppId(e),this._DeviceToken=t,this.log("Registering on Puship for device"+this.getCurrentOs().value),i||(i={}),this.log("Optional params: "+JSON.stringify(i));var s=this.defaultValue(i.successCallback,function(t){t.log("Internal puship success managed")}),a=this.defaultValue(i.failCallback,function(t){t.log("Internal puship fail managed")}),n=new XMLHttpRequest;this.log("AppId:"+e),this.log("Token:"+this._DeviceToken),this.log("DeviceType:"+this.getCurrentOs().value);var o=this._Domain+"services/puship.svc/RegisterDevice?AppId='"+e+"'&DeviceType="+this.getCurrentOs().value+"&Token='"+this._DeviceToken+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&language='en'";return o+="&$format=json",this.log("RequestTo:"+o),n.open("GET",o,!0),n.onreadystatechange=createDelegate(function(){if(4==n.readyState)if(this.log("Processing responce"),200==n.status||201==n.status){var e=JSON.parse(n.responseText).d.RegisterDevice;200==e?(this.log("Registered succesfully"),this.DeviceToken=t,s(this)):(this.log("Error during registration device execution"),this.writeResponceStatus(e),a(e))}else this.log("Error during registration"+n.status),a(n)},this),this.log("Calling RegisterOnPuship endpoint"),n.send(),this},this.getPushMessagesInternal=function(t){t||(t={}),this.log("Optional params: "+JSON.stringify(t));var e=this.defaultValue(t.limit,20),i=this.defaultValue(t.offset,0),s=this.defaultValue(t.tag,""),a=this.defaultValue(t.addDevicePush,!1),n=this.defaultValue(t.successCallback,function(t){t.log("Internal puship GetPushMessages success managed")}),o=this.defaultValue(t.failCallback,function(t){t.log("Internal puship GetPushMessages fail managed")}),r=this.defaultValue(t.includeParams,!1);this.log("Get Push Messages...");var l=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId),this.log("Tag:"+s);var u=this._Domain+"Services/Puship.svc/GetPushMessages?AppId='"+this._PushipAppId+"'&DeviceType="+this.getCurrentOs().value+"&Limit="+e+"&Offset="+i+"&Tags='"+s+"'&IncludeParams="+r;a&&(u+="&DeviceId='"+encodeURIComponent(this._DeviceId)+"'"),t.Latitude&&(u+="&Latitude="+t.Latitude),t.Longitude&&(u+="&Longitude="+t.Longitude),u+="&$format=json",this.log("RequestTo:"+u),l.open("GET",u,!0),l.onreadystatechange=createDelegate(function(){if(4==l.readyState)if(200==l.status||201==l.status)try{n(JSON.parse(l.responseText).d)}catch(t){this.log("Error during responce parsing"+l.status),o(t)}else this.log("Error during push getting"+l.status),o(l)},this),this.log("Calling GetPushMessages endpoint"),l.send()},this.getPushMessagesByDeviceInternal=function(t){t||(t={}),this.log("Optional params: "+JSON.stringify(t));var e=this.defaultValue(t.limit,20),i=this.defaultValue(t.offset,0),s=this.defaultValue(t.successCallback,function(t){t.log("Internal puship GetPushMessagesByDevice success managed")}),a=this.defaultValue(t.failCallback,function(t){t.log("Internal puship GetPushMessagesByDevice fail managed")});this.log("Get Push Messages...");var n=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId);var o=this._Domain+"Services/Puship.svc/GetPushMessagesByDevice?DeviceId='"+encodeURIComponent(this._DeviceId)+"'&Limit="+e+"&Offset="+i;o+="&$format=json",this.log("RequestTo:"+o),n.open("GET",o,!0),n.onreadystatechange=createDelegate(function(){if(4==n.readyState)if(200==n.status||201==n.status)try{s(JSON.parse(n.responseText).d)}catch(t){this.log("Error during responce parsing"+n.status),a(t)}else this.log("Error during push getting"+n.status),a(n)},this),this.log("Calling GetPushMessagesByDevice endpoint"),n.send()},this.pushCurrentPositionSuccess=function(t){this.log("Latitude: "+t.coords.latitude+"\nLongitude: "+t.coords.longitude+"\nAltitude: "+t.coords.altitude+"\nAccuracy: "+t.coords.accuracy+"\nAltitude Accuracy: "+t.coords.altitudeAccuracy+"\nHeading: "+t.coords.heading+"\nSpeed: "+t.coords.speed+"\nTimestamp: "+t.timestamp+"\n"),pushOptionalParams.Latitude=t.coords.latitude,pushOptionalParams.Longitude=t.coords.longitude,this.getPushMessagesInternal(pushOptionalParams)},this.pushCurrentPositionError=function(t){var e=this.defaultValue(pushOptionalParams.failCallback,function(t){this.log("Internal puship GetPushMessage fail managed")});this.log("code: "+t.code+"\nmessage: "+t.message+"\n"),e(t)},this.addTagFilterInternal=function(t,e){e||(e={}),this.log("Optional params: "+JSON.stringify(e));var i=this.defaultValue(e.successCallback,function(t){t.log("Internal puship addfilter success managed")}),s=this.defaultValue(e.failCallback,function(t){t.log("Internal puship addfilter fail managed")}),a=this.defaultValue(e.removePrevTag,!1);this.log("Adding Tag Filter...");var n=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId),this.log("Tag:"+t);var o=this._Domain+"Services/Puship.svc/AddTagFilter?AppId='"+this._PushipAppId+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&Tag='"+t+"'&RemovePrevTag="+a+"&$format=json";this.log("RequestTo:"+o),n.open("GET",o,!0),n.onreadystatechange=createDelegate(function(){if(4==n.readyState)if(200==n.status||201==n.status)try{var t=JSON.parse(n.responseText).d.AddTagFilter;200==t?(this.log("Filter added succesfully"),i(this)):(this.log("Error during filter adding execution"),this.writeResponceStatus(t),s(t))}catch(t){this.log("Error during responce parsing"+n.status),s(t)}else this.log("Error during filter adding"+n.status),s(n)},this),this.log("Calling AddTagFilter endpoint"),n.send()},this.removeTagFilterInternal=function(t,e){e||(e={}),this.log("Optional params: "+JSON.stringify(e));var i=this.defaultValue(e.successCallback,function(t){t.log("Internal puship removefilter success managed")}),s=this.defaultValue(e.failCallback,function(t){t.log("Internal puship removefilter fail managed")});this.log("Removing Tag Filter...");var a=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId),this.log("Tag:"+t);var n=this._Domain+"Services/Puship.svc/RemoveTagFilter?AppId='"+this._PushipAppId+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&Tag='"+t+"'&$format=json";this.log("RequestTo:"+n),a.open("GET",n,!0),a.onreadystatechange=createDelegate(function(){if(4==a.readyState)if(200==a.status||201==a.status)try{var t=JSON.parse(a.responseText).d.RemoveTagFilter;200==t?(this.log("Filter removed succesfully"),i(this)):(this.log("Error during filter removing execution"),this.writeResponceStatus(t),s(t))}catch(t){this.log("Error during responce parsing"+a.status),s(t)}else this.log("Error during Filter removing"+a.status),s(a)},this),this.log("Calling RemoveTagFilter endpoint"),a.send()},this.cleanTagFilterInternal=function(t){t||(t={}),this.log("Optional params: "+JSON.stringify(t));var e=this.defaultValue(t.successCallback,function(t){t.log("Internal puship cleanfilter success managed")}),i=this.defaultValue(t.failCallback,function(t){t.log("Internal puship cleanfilter fail managed")});this.log("Cleaning Tag Filter...");var s=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId);var a=this._Domain+"services/puship.svc/CleanTagFilter?AppId='"+this._PushipAppId+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&$format=json";this.log("RequestTo:"+a),s.open("GET",a,!0),s.onreadystatechange=createDelegate(function(){if(4==s.readyState)if(this.log("Processing responce"),200==s.status||201==s.status)try{var t=JSON.parse(s.responseText).d.CleanTagFilter;200==t?(this.log("Filter cleaned succesfully"),e(this)):(this.log("Error during filter cleaning execution"),this.writeResponceStatus(t),i(t))}catch(t){this.log("Error during responce parsing"+s.status),i(t)}else this.log("Error during push getting"+s.status),i(s)},this),this.log("Calling CleanTagFilter endpoint"),s.send()},this.getTagFiltersInternal=function(t){t||(t={}),this.log("Optional params: "+JSON.stringify(t));var e=this.defaultValue(t.successCallback,function(t){t.log("Internal puship getfilter success managed")}),i=this.defaultValue(t.failCallback,function(t){caller.log("Internal puship getfilter fail managed")});this.log("Get Tag Filters...");var s=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId);var a=this._Domain+"services/puship.svc/GetTagFilters?AppId='"+this._PushipAppId+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&$format=json";this.log("RequestTo:"+a),s.open("GET",a,!0),s.onreadystatechange=createDelegate(function(){if(4==s.readyState)if(this.log("Processing responce"),200==s.status||201==s.status)try{e(JSON.parse(s.responseText).d)}catch(t){this.log("Error during responce parsing"+s.status),i(t)}else this.log("Error during filter getting"+s.status),i(s)},this),this.log("Calling GetTagFilters endpoint"),s.send()};var t=!1,e=null;this.registerCurrentPositionInternal=function(i){if(this.log("RegisterCurrentPosition with Optional params: "+JSON.stringify(i)),t||(maxRegisterQueue=this._PositionQueueLenght,t=!0),i?(positionOptionalParams=i,null!=positionOptionalParams.callMinutes&&positionOptionalParams.callMinutes<this._MinimumSingleLocationCallDelayMinutes&&(positionOptionalParams.callMinutes=this._MinimumSingleLocationCallDelayMinutes),null==positionOptionalParams.minimumAccuracy&&(positionOptionalParams.minimumAccuracy=this._MinimumAccuracy)):(positionOptionalParams={},positionOptionalParams.enableHighAccuracy=!1,positionOptionalParams.callMinutes=this._DefaultLocationCallDelayMinutes,positionOptionalParams.minimumAccuracy=this._MinimumAccuracy=50),positionOptionalParams.successCallback=this.defaultValue(positionOptionalParams.successCallback,function(t){t.log("Internal puship RegisterPosition success managed")}),positionOptionalParams.failCallback=this.defaultValue(positionOptionalParams.failCallback,function(t){t.log("Internal puship RegisterPosition fail managed")}),this.getCurrentOs()==Puship.prototype.OS.ANDROID&&(positionOptionalParams.enableHighAccuracy=!0),null!=e){var s=new Date;if(e.getTime()+6e4*positionOptionalParams.callMinutes>=s.getTime())return this.log("Position Skipped due to many request"),void positionOptionalParams.failCallback("Position Skipped due to many request")}e=new Date;var a=createDelegate(this.currentPositionSuccess,this),n=createDelegate(this.currentPositionError,this);navigator.geolocation.getCurrentPosition(a,n,positionOptionalParams)},this.currentPositionSuccess=function(t){if(!this.verifyAccuracy(positionOptionalParams.enableHighAccuracy,t.coords.accuracy,positionOptionalParams.minimumAccuracy))return e=null,this.log("Position skipped due to inadeguate accuracy"),void positionOptionalParams.failCallback("Position skipped due to inadeguate accuracy");this.log("Optional params: "+JSON.stringify(positionOptionalParams)),this.log("Latitude: "+t.coords.latitude+"\nLongitude: "+t.coords.longitude+"\nAltitude: "+t.coords.altitude+"\nAccuracy: "+t.coords.accuracy+"\nAltitude Accuracy: "+t.coords.altitudeAccuracy+"\nHeading: "+t.coords.heading+"\nSpeed: "+t.coords.speed+"\nTimestamp: "+t.timestamp+"\n");var i=new Date(t.timestamp),s=this.iSODateString(i);this.log("ISO date: "+s),this.log("Registering Position...");var a=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId);var n=this._Domain+"services/puship.svc/RegisterPosition?AppId='"+this._PushipAppId+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&Latitude="+t.coords.latitude+"&Longitude="+t.coords.longitude+"&Accuracy="+t.coords.accuracy+"&TimeStamp=datetime'"+s+"'";t.coords.speed&&(n+="&Speed="+t.coords.speed),t.coords.heading&&(n+="&Heading="+t.coords.heading),t.coords.altitude&&(n+="&Altitude="+t.coords.altitude),t.coords.altitudeAccuracy&&(n+="&AltitudeAccuracy="+t.coords.altitudeAccuracy),n+="&$format=json",this.log("RequestTo:"+n),a.open("GET",n,!0),a.onreadystatechange=createDelegate(function(){if(4==a.readyState)if(this.log("Processing responce"),200==a.status||201==a.status)try{var t=JSON.parse(a.responseText).d.RegisterPosition;200==t?(this.log("Position Registered succesfully"),positionOptionalParams.successCallback(this)):(this.log("Error during registration position execution"),this.writeResponceStatus(t),positionOptionalParams.failCallback(t))}catch(t){this.log("Error during responce parsing"+a.status),positionOptionalParams.failCallback(t)}else this.log("Error during call to registration position"+a.status),positionOptionalParams.failCallback(a)},this),this.log("Calling RegisterPosition endpoint"),a.send()},this.currentPositionError=function(t){this.log("code: "+t.code+"\nmessage: "+t.message+"\n"),e=null,positionOptionalParams.failCallback(t)};var i=null,s=null,a=null;this.clearWatchInternal=function(){this.log("ClearWatch with id: "+a),this.isNullOrEmpty(a)?this.log("Watch is not active!"):(navigator.geolocation.clearWatch(a),s=null,a=null,this.log("Uploading remaining data..."),this.internalWatchTryToUpload())},this.watchIsActiveInternal=function(){return!this.isNullOrEmpty(a)},this.watchPositionInternal=function(t){if(this.log("WatchPosition with Optional params: "+JSON.stringify(t)),this.isNullOrEmpty(a)){a="temporary watch ID",t?(null!=(i=t).callMinutes&&i.callMinutes<this._MinimumLocationCallDelayMinutes&&(i.callMinutes=this._MinimumLocationCallDelayMinutes),null==i.minimumAccuracy&&(i.minimumAccuracy=this._MinimumAccuracy)):((i={}).enableHighAccuracy=!1,i.callMinutes=this._DefaultLocationCallDelayMinutes,i.minimumAccuracy=this._MinimumAccuracy=50),this.getCurrentOs()==Puship.prototype.OS.ANDROID&&(i.enableHighAccuracy=!0);var e=6e4*i.callMinutes;this.log("WatchPosition event setted with: "+e),s=setInterval(createDelegate(function(){this.log("watchPositionSuccess setTimeout raised for: "+a);var t=this.countItemOnLocalStorage("watchPositionQueue");this.log("itemsToUpload: "+t),this.isNullOrEmpty(a)&&null==s&&0==t?(clearTimeout(s),this.log("watchtimeout stopped")):this.internalWatchTryToUpload()},this),e);var n=createDelegate(this.watchPositionSuccess,this),o=createDelegate(this.currentWatchPositionError,this);a=navigator.geolocation.watchPosition(n,o,i)}},this.watchPositionSuccess=function(t){this.verifyAccuracy(i.enableHighAccuracy,t.coords.accuracy,i.minimumAccuracy)?(this.log("New pos, Lat:"+t.coords.latitude+", Lon:"+t.coords.longitude),this.pushItemToLocalStorage("watchPositionQueue",this.convertPosition(t))):this.log("Position skipped due to inadeguate accuracy")},this.currentWatchPositionError=function(t){this.log("code: "+t.code+"\nmessage: "+t.message+"\n"),i.failCallback(t)},this.internalWatchTryToUpload=function(){var t=this.getLastItemsFromLocalStorage("watchPositionQueue",this._PositionQueueLenght),e=Object.keys(t).length;if(0!=e){this.log("position items to upload: "+e);var s="positions="+JSON.stringify(t),a=this.defaultValue(i.successCallback,function(t){t.log("Internal puship RegisterPosition success managed")}),n=this.defaultValue(i.failCallback,function(t){t.log("Internal puship RegisterPosition fail managed")}),o=new XMLHttpRequest,r=this._Domain+"services/puship.svc/RegisterMultiPosition?AppId='"+this._PushipAppId+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&$format=json";o.open("POST",r,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),o.setRequestHeader("Content-length",s.length),o.setRequestHeader("Connection","close"),o.onreadystatechange=createDelegate(function(){if(4==o.readyState)if(200==o.status||201==o.status)try{var t=JSON.parse(o.responseText).d.RegisterMultiPosition;200==t?(this.log("MultiPositions Registered succesfully: "+e),this.removeItemsFromLocalStorage("watchPositionQueue",e),a(this)):(this.log("Error during MultiPositions execution"),n(t))}catch(t){this.log("Error during responce parsing "+o.status),n(t)}else this.log("Error during call to MultiPositions "+o.status),n(o)},this),this.log("Calling MultiPositions endpoint"),o.send(s)}else this.log("no positions items to upload:")},this.unregisterFromPushipInternal=function(t){t||(t={}),this.log("Optional params: "+JSON.stringify(t));var e=this.defaultValue(t.successCallback,function(t){t.log("Internal puship unregister success managed")}),i=this.defaultValue(t.failCallback,function(t){t.log("Internal puship unregister fail managed")});this.log("deleteing push...");var s=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId);var a=this._Domain+"services/puship.svc/UnRegisterDevice?AppId='"+this._PushipAppId+"'&DeviceIdentifier='"+encodeURIComponent(this._DeviceId)+"'&$format=json";this.log("RequestTo:"+a),s.open("GET",a,!0),s.onreadystatechange=createDelegate(function(){if(4==s.readyState)if(this.log("Processing responce"),200==s.status||201==s.status)try{this.log(s.responseText);JSON.parse(s.responseText);var t=JSON.parse(s.responseText).d.UnRegisterDevice;200==t?(this.log("Device unregisted successfully"),e(this)):(this.log("Error during device unregistration execution"),this.writeResponceStatus(t),i(t))}catch(t){this.log("Error during responce parsing: "+s.status),i(t)}else this.log("Error during Push delete: "+s.status),i(s)},this),this.log("Calling unregister from puship endpoint"),s.send()},this.deletePushMessageInternal=function(t,e){e||(e={}),this.log("Optional params: "+JSON.stringify(e));var i=this.defaultValue(e.successCallback,function(t){t.log("Internal puship removefilter success managed")}),s=this.defaultValue(e.failCallback,function(t){t.log("Internal puship removefilter fail managed")});this.log("deleteing push...");var a=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId),this.log("Push_Id:"+t);var n=this._Domain+"services/puship.svc/DeletePushMessages?AppId='"+this._PushipAppId+"'&strPushMessageId='"+t+"'&$format=json";this.log("RequestTo:"+n),a.open("GET",n,!0),a.onreadystatechange=function(){if(4==a.readyState)if(this.log("Processing responce"),200==a.status||201==a.status)try{this.log(a.responseText);JSON.parse(a.responseText);var t=JSON.parse(a.responseText).d.DeletePushMessages;0==t.Error?(this.log("Push deleted successfully"),i(t)):(this.log("Error during push delete execution"),this.writeResponceStatus(code),s(t))}catch(t){this.log("Error during responce parsing: "+a.status),s(t)}else this.log("Error during Push delete: "+a.status),s(a)},this.log("Calling DeletePushMessages endpoint"),a.send()},this.sendPushByDeviceInternal=function(t,e,i){this.log("Sending Push by Device: "+t+" to "+JSON.stringify(e)),i||(i={}),this.log("Optional params: "+JSON.stringify(i));var s=this.defaultValue(i.successCallback,function(t){t.log("Internal puship success managed")}),a=this.defaultValue(i.failCallback,function(t){t.log("Internal puship fail managed")}),n=this.defaultValue(i.sound,"default"),o=this.defaultValue(i.push,"True"),r=new XMLHttpRequest;this.log("AppId:"+this._PushipAppId);var l=this._Domain+"services/puship.svc/SendPushMessageByDevicePost?$format=json";this.log("RequestTo: "+l);var u="language=en&AppId="+this._PushipAppId+"&Devices="+JSON.stringify(e);u=(u=(u=u+"&Message="+t)+"&Push="+o)+"&Sound="+n,null!=i.params&&(u=u+"&Params="+JSON.stringify(i.params)),this.log("PostParams: "+u),r.open("POST",l,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),r.setRequestHeader("Content-length",u.length),r.setRequestHeader("Connection","close"),r.onreadystatechange=createDelegate(function(){if(4==r.readyState)if(200==r.status||201==r.status){var t=JSON.parse(r.responseText).d.SendPushMessageByDevicePost;0==t.Error?(this.log("Push sent successfully"),s(t)):(this.log("Error during push sent execution"),this.writeResponceStatus(code),a(t))}else this.log("Error during SendPushByDevice"+r.status),a(r)},this),this.log("Calling SendPushByDevice endpoint"),r.send(u)}}Puship.prototype.PushipAppId=function(t){return this._PushipAppId=t,this._DeviceId=t+"_"+this.getUuid(),this._DeviceId},Puship.prototype.DeviceId=function(){return this._DeviceId},Puship.prototype.DeviceToken=function(){return this._DeviceToken},Puship.prototype.EnableLog=function(t){this._EnableLog=t},Puship.prototype.EnableHtmlLog=function(t){this._EnableHtmlLog=t},Puship.prototype.MinimumLocationCallDelayMinutes=function(t){this._MinimumLocationCallDelayMinutes=t},Puship.prototype.MinimumSingleLocationCallDelayMinutes=function(t){this._MinimumSingleLocationCallDelayMinutes=t},Puship.prototype.MinimumAccuracy=function(t){this._MinimumAccuracy=t},Puship.prototype.PositionQueueLenght=function(t){this._PositionQueueLenght=t},Puship.prototype.OS={IOS:{value:1,name:"iOS",code:"IOS"},ANDROID:{value:2,name:"Android",code:"ANDROID"},WIN:{value:3,name:"Windows",code:"WIN"},BLACKBERRY:{value:4,name:"BlackBerry",code:"BB"}};var RESPONSESTATUS={REGISTERED:{value:200,name:"Registered",code:"REGISTERED"},GENERICERROR:{value:500,name:"Generic Error",code:"GENERICERROR"},PERMISSIONERROR:{value:400,name:"Permission Error",code:"PERMISSIONERROR"},DEVICELIMITERROR:{value:401,name:"Device Limit Error",code:"DEVICELIMITERROR"},TAGLIMITERROR:{value:402,name:"Tag Limit Error",code:"TAGLIMITERROR"},CREDENTIALERROR:{value:403,name:"Credential Error",code:"CREDENTIALERROR"},APPLICATIONNOTFOUND:{value:404,name:"Application not found",code:"APPLICATIONNOTFOUND"},DEVICENOTFOUND:{value:405,name:"Device not found",code:"DEVICENOTFOUND"}};function createDelegate(t,e){return function(){return t.apply(e,arguments)}}var pushOptionalParams=null;Puship.prototype.GetPushMessages=function(t){if(1==(pushOptionalParams=t||{}).byCurrentPosition){if(this.log("byCurrentPosition is checked"),null==pushOptionalParams.Latitude||null==pushOptionalParams.Longitude){this.getCurrentOs()==Puship.prototype.OS.ANDROID&&(t.enableHighAccuracy=!0);var e=createDelegate(this.pushCurrentPositionSuccess,this),i=createDelegate(this.pushCurrentPositionError,this);navigator.geolocation.getCurrentPosition(e,i,t)}}else this.getPushMessagesInternal(pushOptionalParams)},Puship.prototype.Register=function(t,e,i){return this.registerInternal(t,e,i)},Puship.prototype.GetPushMessagesByDevice=function(t){return this.getPushMessagesByDeviceInternal(t)},Puship.prototype.AddTagFilter=function(t,e){return this.addTagFilterInternal(t,e)},Puship.prototype.RemoveTagFilter=function(t,e){return this.removeTagFilterInternal(t,e)},Puship.prototype.CleanTagFilter=function(t){return this.cleanTagFilterInternal(t)},Puship.prototype.GetTagFilters=function(t){return this.getTagFiltersInternal(t)},Puship.prototype.RegisterCurrentPosition=function(t){return this.registerCurrentPositionInternal(t)},Puship.prototype.ActivateWatchPosition=function(t){return this.watchPositionInternal(t)},Puship.prototype.StopWatchPosition=function(t){return this.clearWatchInternal(t)},Puship.prototype.WatchIsActive=function(){return this.watchIsActiveInternal()},Puship.prototype.UnregisterFromPuship=function(t){return this.unregisterFromPushipInternal(t)},Puship.prototype.SendPushByDevice=function(t,e,i){return this.sendPushByDeviceInternal(t,e,i)},Storage.prototype.setObj=function(t,e){return this.setItem(t,JSON.stringify(e))},Storage.prototype.getObj=function(t){return JSON.parse(this.getItem(t))},"undefined"!=typeof module&&module.exports&&(module.exports=new Puship);